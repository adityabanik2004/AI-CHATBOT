<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chatbot</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="chat-container">
    <div class="header">
        <h2>AI Chatbot</h2>
        <button class="refresh-btn" onclick="clearChat()" title="Clear Chat">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
            </svg>
        </button>
    </div>

    <div id="chat-box">
        <div class="welcome-message">
            <p>ðŸ‘‹ Welcome! I'm your AI assistant </p>
            <p>Ask me anything to get started...</p>
        </div>
    </div>

    <div class="input-container">
        <textarea 
            id="user-input" 
            placeholder="Type your message here..." 
            rows="1"
            onkeypress="handleKeyPress(event)"
        ></textarea>
        <button class="send-btn" onclick="sendMessage()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
            </svg>
        </button>
    </div>
</div>

<script>
function sendMessage() {
    let input = document.getElementById("user-input");
    let message = input.value.trim();

    if (message === "") return;

    let chatBox = document.getElementById("chat-box");
    
    // Remove welcome message if it exists
    let welcomeMsg = chatBox.querySelector('.welcome-message');
    if (welcomeMsg) {
        welcomeMsg.remove();
    }

    // Add user message
    let userDiv = document.createElement('div');
    userDiv.className = 'message user-message';
    userDiv.innerHTML = `
        <div class="message-content">
            <div class="message-label">You</div>
            <div class="message-text">${escapeHtml(message)}</div>
        </div>
    `;
    chatBox.appendChild(userDiv);

    // Add typing indicator
    let typingDiv = document.createElement('div');
    typingDiv.className = 'message bot-message typing-indicator';
    typingDiv.innerHTML = `
        <div class="message-content">
            <div class="message-label">Groq AI</div>
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    `;
    chatBox.appendChild(typingDiv);
    chatBox.scrollTop = chatBox.scrollHeight;

    // Send request
    fetch("/chat", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({message: message})
    })
    .then(res => res.json())
    .then(data => {
        // Remove typing indicator
        typingDiv.remove();

        // Add bot response
        let botDiv = document.createElement('div');
        botDiv.className = 'message bot-message';
        botDiv.innerHTML = `
            <div class="message-content">
                <div class="message-label">Groq AI</div>
                <div class="message-text">${escapeHtml(data.reply)}</div>
            </div>
        `;
        chatBox.appendChild(botDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
    })
    .catch(error => {
        // Remove typing indicator on error
        typingDiv.remove();
        
        let errorDiv = document.createElement('div');
        errorDiv.className = 'message error-message';
        errorDiv.innerHTML = `
            <div class="message-content">
                <div class="message-label">Error</div>
                <div class="message-text">Failed to get response. Please try again.</div>
            </div>
        `;
        chatBox.appendChild(errorDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
    });

    input.value = "";
    autoResize(input);
}

function clearChat() {
    let chatBox = document.getElementById("chat-box");
    chatBox.innerHTML = `
        <div class="welcome-message">
            <p>ðŸ‘‹ Welcome! I'm your AI assistant</p>
            <p>Ask me anything to get started...</p>
        </div>
    `;
}

function handleKeyPress(event) {
    if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
    }
}

function autoResize(textarea) {
    textarea.style.height = 'auto';
    textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Auto-resize textarea on input
document.getElementById('user-input').addEventListener('input', function() {
    autoResize(this);
});
</script>

</body>
</html>